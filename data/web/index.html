<html>
	<head>
		<title>Welcome</title>
		<script src="jquery-1.3.2.min.js"></script>
		<script src="jquery.tools.min.js"></script>
		<script>
			function refreshGSM() {
				$.getJSON("/api/1.0/gsm/status",
					function(data){
						$("#gsm").text(data.strength);
				});
			}

			function refreshALL() {
				refreshGSM();
			}

			function deleteGPX(item) {
				$.ajax({
					type: "DELETE",
					url: "/api/1.0/gpx/item?item="+item.data,
					dataType: "json",
					success: function(data){listGPX();}
				});
			}

			function listGPX() {
				$.getJSON("/api/1.0/gpx/list",
					function(data){
						$("#gpxlist").empty();
						if (data.length > 0) {
							$.each(data, function(i,item){
								var line = $("<li/>");
								line.append($("<a/>").attr('href', '/api/1.0/gpx/item?item='+item.name).text(item.name));
								line.append(' ');
								line.append(item.size);
								line.append(' ');
								line.append($("<a/>").attr('href', '/api/1.0/gpx/item?format=gpx&item='+item.name).text("As GPX"));
								line.append(' ');
								line.append($("<a/>").attr('href','#').bind("click", item.name, deleteGPX).text('Delete'));
								line.appendTo("#gpxlist");
							});
						} else {
							$("<li/>").text("No gpx traces found").appendTo("#gpxlist");
						}
					}
				)
			}

			function init() {
				$("ul.tabs").tabs("div.panes > div");
				refreshALL();
			}

			$(document).ready(init);
		</script>

		<!-- tab styling -->
		<link rel="stylesheet" type="text/css" href="tabs.css" />
	</head>
	<body>
		<h1>FreeRunner Web Manager</h1>
		<p>Control your FreeRunner from a web interface.</p>

		<ul class="tabs">
			<li><a href="#">Status</a></li>
			<li><a href="#">GPX</a></li>
		</ul>

		<div class="panes">
			<!-- Status tab -->
			<div>
				<ul><li>GSM: <span id="gsm">getting info...</span></li>
					<li><a href="#refresh" onclick="refreshALL(); return false;">Refresh</a></li>
				</ul>
			</div>

			<!-- GPX tab -->
			<div>
				<ul id="gpxlist"></ul>
				<a href="#" onclick="listGPX(); return false;">Load GPX List</a>
			</div>
		</div>
	</body>
</html>
